id: 07_aws_setup
namespace: zoomcamp

tasks:
  - id: create_s3_bucket
    type: io.kestra.plugin.aws.s3.CreateBucket
    bucket: "{{kv('S3_BUCKET_NAME')}}"

  - id: create_glue_database
    type: io.kestra.plugin.aws.athena.Query
    database: default
    outputLocation: "{{kv('ATHENA_OUTPUT_LOCATION')}}"
    query: |
      CREATE DATABASE IF NOT EXISTS {{kv('AWS_DATASET')}}

pluginDefaults:
  - type: io.kestra.plugin.aws
    values:
      accessKeyId: "{{kv('AWS_ACCESS_KEY_ID')}}"
      secretKeyId: "{{kv('AWS_SECRET_ACCESS_KEY')}}"
      region: "{{kv('AWS_REGION')}}"
